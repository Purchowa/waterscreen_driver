#include <stdarg.h>
#include <setjmp.h>
#include <cmocka.h>

#include "standard_mode_picture_getters.h"

#define EXPECTED_TIME_PICTURE_SIZE 24
void givenTime_getCurrentTimeAsPicture_returnEndLoopAndProvideTimePicture()
{
    const pictureRow_t expectedTimePicture[EXPECTED_TIME_PICTURE_SIZE] = {
        0b0000000000000000000000000000000000000000000000000000000000000000,
        0b0000011111000000011111111110000000000111111111110000000000111110,
        0b0000111111000000111111111111000000001111111111111000000001111110,
        0b0111111111000001111111111111100000011111111111111000000011111110,
        0b0111111111000001111111111111100000011111111111111000000111111110,
        0b0111111111000001111111111111100000011111111111111000001111111110,
        0b0111111111000001111110011111101111011111000111111000011111111110,
        0b0111111111000001111100001111101111011110000011111000111111111110,
        0b0000011111000001111100001111101111000000000011111001111110111110,
        0b0000011111000000000000001111100000000000000111111011111100111110,
        0b0000011111000000000000011111100000000001111111110011111000111110,
        0b0000011111000000000000111111100000000001111111100011110000111110,
        0b0000011111000000000001111111000000000001111111100011110000111110,
        0b0000011111000000000011111110000000000001111111110011111111111111,
        0b0000011111000000000111111100000000000000000111111011111111111111,
        0b0000011111000000001111111000001111000000000011111011111111111111,
        0b0000011111000000011111110000001111011110000011111011111111111111,
        0b0000011111000000111111100000001111011111000111111000000000111110,
        0b1111111111111101111111111111100000011111111111111000000000111110,
        0b1111111111111101111111111111100000011111111111111000000000111110,
        0b1111111111111101111111111111100000011111111111111000000000111110,
        0b1111111111111101111111111111100000001111111111111000000000111110,
        0b1111111111111101111111111111100000000111111111110000000000111110,
        0b0000000000000000000000000000000000000000000000000000000000000000 };

    const PictureDataView_t *pictureDataViewPtr;
    const Datetime_t         datetime             = { .time = { .hour = 12, .minute = 34 } };
    const WeatherCondition_t insignificantWeather = Rain;

    const PictureGetterLoopStatus_t loopStatus =
        getCurrentTimeAsPicture( &pictureDataViewPtr, &datetime, insignificantWeather );

    assert_int_equal( loopStatus, PictureGetterEndLoop );
    assert_int_equal( pictureDataViewPtr->size, EXPECTED_TIME_PICTURE_SIZE );
    assert_memory_equal( pictureDataViewPtr->data, expectedTimePicture,
                         sizeof( pictureRow_t ) * EXPECTED_TIME_PICTURE_SIZE );
}

int main()
{
    const struct CMUnitTest tests[] = {
        cmocka_unit_test( givenTime_getCurrentTimeAsPicture_returnEndLoopAndProvideTimePicture ) };

    return cmocka_run_group_tests_name( "Standard mode picture getters logic test ", tests, NULL, NULL );
}
